
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="QuantJourney with Code is a blog about quantitative finance, data science, and programming.">
      
      
        <meta name="author" content="Jakub Polec">
      
      
        <link rel="canonical" href="https://quantjourney.github.io/tutorials/backtesting-general/">
      
      
        <link rel="prev" href="../../strat/strategies/">
      
      
        <link rel="next" href="../../videos/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>Backtesting - QuantJourney with Code</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons&display=swap">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#backtesting_-_how_easy_is_it_to_get_it_wrong" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="QuantJourney with Code" class="md-header__button md-logo" aria-label="QuantJourney with Code" data-md-component="logo">
      
  <img src="../../images/logo_small_with_text_transparent.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QuantJourney with Code
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Backtesting
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81 1.42-1.42M1 13h3v-2H1m12 9h-2v3h2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../.." class="md-tabs__link">
          
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../doc/documentation/" class="md-tabs__link">
          
  
  Documentation

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../strat/strategies/" class="md-tabs__link">
          
  
  Strategies

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tutorials/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../videos/" class="md-tabs__link">
        
  
    
  
  Videos

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="QuantJourney with Code" class="md-nav__button md-logo" aria-label="QuantJourney with Code" data-md-component="logo">
      
  <img src="../../images/logo_small_with_text_transparent.png" alt="logo">

    </a>
    QuantJourney with Code
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Home
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/strategies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strategies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Backtesting
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Backtesting
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design_testing_and_optimisation_of_bactestig_systems" class="md-nav__link">
    <span class="md-ellipsis">
      Design, Testing, and Optimisation of Bactestig Systems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtesting_principles" class="md-nav__link">
    <span class="md-ellipsis">
      Backtesting Principles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtesting_framework_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Backtesting Framework Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backtesting Framework Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing_a_benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing a benchmark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing_an_objective" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing an Objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading_strategy_filters_indicators_signals_rules" class="md-nav__link">
    <span class="md-ellipsis">
      Trading Strategy (Filters, Indicators, Signals, Rules)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    <span class="md-ellipsis">
      Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indicators" class="md-nav__link">
    <span class="md-ellipsis">
      Indicators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signals" class="md-nav__link">
    <span class="md-ellipsis">
      Signals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Videos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Overview
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/repo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repository Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataBase Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    _______________________
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Data Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/utils/data_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/utils/data_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Connector
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Assets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/indices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Indices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/crypto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crypto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/equities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Equities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/etfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ETFs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/forex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/futures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Futures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/macro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/bonds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/commodities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commodities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/assets/reits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REITs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Connectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/ccxt_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CCXT Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/eod_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EOD Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/fmp_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FMP Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/cnnfg_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CNNFG Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/fred_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FRED Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/oanda_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Oanda Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/quandl_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quandl Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/sec_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SEC Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/connectors/yf_connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yahoo Finance Connector
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Exchanges
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Exchanges
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/exchanges/ibkr_exchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IBKR Exchange
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    _______________________
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Backtesting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Backtesting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/base_class/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/cost_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cost Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/data_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/execution_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execution Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/forecast_engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forecast Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/market_regime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Market Regime
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/market_regime_with_ml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Market Regime with ML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/monte_carlo_analyzer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monte Carlo Analyzer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/performance_analytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance Analytics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/performance_reporting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance Reporting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/portfolio_construction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio Construction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/portfolio_optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio Optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/profitloss_tracker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profit/Loss Tracker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/risk_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/signal_generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Signal Generator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/transaction_cost_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transaction Cost Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/engine/volatility_engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Volatility Engine
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Portfolio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Portfolio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../portfolio/portfolio.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Strategies
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Strategies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/strategies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strategies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistical Arbitrage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/momentum_investing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Momentum Investing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/mean_reversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mean Reversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/machine_learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning Techniques
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/hft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    High-Frequency Trading (HFT)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/factor_investing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Factor Investing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../strat/statistical_arbitrage/event_driven/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event-Driven Strategies
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Substack Blog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Videos
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design_testing_and_optimisation_of_bactestig_systems" class="md-nav__link">
    <span class="md-ellipsis">
      Design, Testing, and Optimisation of Bactestig Systems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtesting_principles" class="md-nav__link">
    <span class="md-ellipsis">
      Backtesting Principles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtesting_framework_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Backtesting Framework Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backtesting Framework Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing_a_benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing a benchmark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing_an_objective" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing an Objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading_strategy_filters_indicators_signals_rules" class="md-nav__link">
    <span class="md-ellipsis">
      Trading Strategy (Filters, Indicators, Signals, Rules)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    <span class="md-ellipsis">
      Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indicators" class="md-nav__link">
    <span class="md-ellipsis">
      Indicators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signals" class="md-nav__link">
    <span class="md-ellipsis">
      Signals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="backtesting_-_how_easy_is_it_to_get_it_wrong">Backtesting - How easy is it to get it wrong?<a class="headerlink" href="#backtesting_-_how_easy_is_it_to_get_it_wrong" title="Permanent link">&para;</a></h1>
<p>In today’s post you will read about:</p>
<ul>
<li>backtesting principles like setting benchmarks and objectives to avoid unsuitable ideas and overfitting,</li>
<li>details the components of a trading strategy including filters, signals, and rules,</li>
<li>how to implement and evaluate backtesting and trading strategies through code snippets.</li>
</ul>
<h2 id="design_testing_and_optimisation_of_bactestig_systems">Design, Testing, and Optimisation of Bactestig Systems<a class="headerlink" href="#design_testing_and_optimisation_of_bactestig_systems" title="Permanent link">&para;</a></h2>
<p>The benefit of an accurately tested systematic strategy is trading profit. </p>
<p>Many analysts and portfolio managers face numerous challenges when developing systematic trading systems.  Each part of the system must be carefully built to ensure it doesn’t lose money and stays financially stable. The process includes formulating hypothesis, then turning  trading ideas into tests, regularly checking the results, and carefully managing the risks of overfitting. A well-designed system not only helps in evaluating and refining strategies but also keeps them competitive in fast-changing markets. It needs to be quick, enabling you to test your idea within minutes. Ideally, it should not take more than 30 minutes from conception to confirmation and subsequent refinement. </p>
<p>You might ask why not just use established backtesting tools like Backtrader or QuantConnect? The simple answer, as Jim Simons has previously addressed, is that using common tools often yields common results. While these platforms are suitable for basic strategies and can provide quick outcomes, they are less adept at handling more sophisticated techniques such as conditional portfolio optimizations, regime identification, advanced risk management, and the integration of machine learning. Even if you want to modify their code, it will take you more time and effort to add such capabilities that meet your requirements.</p>
<p>Foremost, here at QuantJourney blog, we are passionate about our educational journey to build your own modern, modular trading system and backtester framework. Learning to code as you go not only enhances your skills but also allows you to customize and directly observe the effects on your code, strategies, and ultimately, your financial returns..</p>
<h2 id="backtesting_principles">Backtesting Principles<a class="headerlink" href="#backtesting_principles" title="Permanent link">&para;</a></h2>
<p>Before diving into coding or developing trading ideas, each investor needs to reflect on some key questions related to their unique trading style and risk tolerance. These aspects vary widely among individuals and are fundamental to your approach. Here are some essential questions to consider:</p>
<ul>
<li>What assets do you plan to trade, and why?</li>
<li>On which exchanges will you trade these assets, and why?</li>
<li>Why not trade assets A, B and C in exchanges E, F and G?</li>
<li>Why would your strategy work?</li>
<li>What is the biggest risk associated with your strategy?</li>
<li>When was last time this major risk occurred and what happened?</li>
<li>What is your investment holding period, and why have you chosen this duration?</li>
<li>What other things could go wrong?</li>
<li>How frequently does the scenario your strategy relies on occur?</li>
<li>What are your profit expectations? Why?</li>
</ul>
<p>Taking the time to answer these questions can seem tedious, but many investors skip this step and potentially end up losing money. The more prepared you are, the lower your chances of losses and the better your prospects for profit—or at least for improving your strategy to become more profitable.</p>
<h2 id="backtesting_framework_blocks">Backtesting Framework Blocks<a class="headerlink" href="#backtesting_framework_blocks" title="Permanent link">&para;</a></h2>
<h3 id="choosing_a_benchmark">Choosing a benchmark<a class="headerlink" href="#choosing_a_benchmark" title="Permanent link">&para;</a></h3>
<p>Selecting a benchmark is crucial but often overlooked by investors. A benchmark allows you to measure your performance and provides insight into how well your strategy performs. However, it's important not to become overly fixated on the benchmark, as this can lead to excessive adjustments. Here are some options for choosing a benchmark:</p>
<ul>
<li><strong>Market Observables</strong>: these are common benchmarks for most traders. Metrics such as $/day, %/day, $/contract, % of daily volume.</li>
<li><strong>Archetypal Strategies</strong>: use established strategies, like an <strong>Moving Average Crossover (MA-cross)</strong> for a momentum strategy, as benchmarks. Or <strong>Moving Average Convergence Divergence (MACD)</strong> to determine the direction and strength of market trends in a trend following.</li>
<li><strong>Alternative Indices</strong>: indices like <strong>S&amp;P 500 Index</strong>, <strong>NASDAQ Composite Index</strong>, or more sophisticated as <strong>Vanguard Total Stock Market Index (VTSMX)</strong> can serve as benchmarks, especially relevant for strategies similar to those indexed, when you trade large caps (more on that below)</li>
<li><strong>Custom Tracking Portfolios</strong>: create a bespoke benchmark by assembling a tracking portfolio that mirrors a specific strategy archetype, such as a capitalization-weighted index which uses market cap to weight securities and rebalances periodically according to the index rules.</li>
</ul>
<p>Good benchmarks provide insight into what drives your strategy returns. Choosing more than one benchmark - which is quite common - can also help prevent overfitting by avoiding an exclusive focus on a single benchmark.</p>
<p>I have implemented simple benchmark parameter in config file for backtesting framework as:</p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;benchmark&quot;</span><span class="p">:</span> <span class="s2">&quot;SPY&quot;</span>  
</code></pre></div>
<p>which further can be expanded to have multiple benchmarks, or more complex ones.</p>
<h3 id="choosing_an_objective">Choosing an Objective<a class="headerlink" href="#choosing_an_objective" title="Permanent link">&para;</a></h3>
<p>When creating a strategy, it's crucial to start with a well-defined objective.</p>
<p>Your business objective should specify the expected returns on your capital, tail risk parameters, the level of leverage you intend to use, and your limits on potential drawdowns.</p>
<p>For example, leverage limits are often strictly defined by your broker, and these directly affect your allowable drawdowns: using 10:1 leverage implies a strict 10% drawdown limit, while 4:1 leverage equates to a 25% drawdown limit. You should also establish clear return objectives, as a strategy may not be worthwhile if it cannot meet these targets.</p>
<p>Once you've defined these objectives, you need to formulate them in a way that allows for easy programmatic evaluation of your strategy.</p>
<p>The most commonly used objective of this type is the Sharpe Ratio (SR) which is most often calculated as mean return over volatility.  There are also many other modified Sharpe-style ratios.</p>
<ul>
<li>Information Ratio: annualised return over annualised risk,</li>
<li>Profit factor: gross profits divided by gross losses,</li>
<li>Sortino Ratio: similar to SR, but focuses only on downside volatility, calculating the excess return over the risk-free rate relative to the downside risk,</li>
<li>Calmar Ratio: annualized return divided by the maximum drawdown,</li>
<li>Return over expected tail loss: returns relative to the tail risk, focusing on potential losses in extreme market condition.</li>
</ul>
<p>Setting benchmarks and objectives early helps discard unsuitable ideas. Without understanding the strategy's context, you risk overfitting and poor analysis.</p>
<h3 id="trading_strategy_filters_indicators_signals_rules">Trading Strategy (Filters, Indicators, Signals, Rules)<a class="headerlink" href="#trading_strategy_filters_indicators_signals_rules" title="Permanent link">&para;</a></h3>
<p>A trading strategy or investment approach is more than just a testable hypothesis. After creating and confirming a hypothesis, you need to specify the strategy. I like the approach which formaizes the strategy structure into: <em>filters →</em> <em>indicators → signals</em>, → and <em>rules</em>.</p>
<h3 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">&para;</a></h3>
<p>Filters help to select the instruments to trade. They may be part of the formulated hypothesis, or they may be market characteristics that allow the rest of the strategy to trade better. For instance, in fundamental equity investing, some strategies consist solely of filters.</p>
<p>In our code we use term <em>eligibility</em> to address filters, which is set in configuration file ‘default_startegy.json’ as:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;eligibility_criteria&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">&quot;active_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;volatility_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0002</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;liquidity_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;excluded_sectors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Banking&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Technology&quot;</span><span class="p">]</span>
</code></pre></div>
<p>which allows to filter equities based on active threshold, volatility, and liquidity. If necessary, you can also exclude certain sectors.</p>
<p>You can also specify the instruments you want to test against your strategy in the same config file or by stating it in the code, as shown below:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">run.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="n">dc</span> <span class="o">=</span> <span class="n">DataConnector</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="k">await</span> <span class="n">dc</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">async_fetch_russell_1000_index</span><span class="p">()</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;Ticker&#39;</span><span class="p">]</span>

    <span class="n">my_strategy</span> <span class="o">=</span> <span class="n">BaseStrategy</span><span class="p">(</span>
                                <span class="n">config_file_path</span><span class="o">=</span><span class="s2">&quot;qlib/backtesting/strategies/default_strategy.json&quot;</span><span class="p">,</span>
                                <span class="n">instruments</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span>
                                <span class="n">trading_range</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2010-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-12-31&#39;</span><span class="p">},</span>
                                <span class="n">initial_capital</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                                <span class="n">backtest_name</span><span class="o">=</span><span class="s2">&quot;my_strategy&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The backtester code checks against them as follows:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_eligibility</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the eligibility of instruments based on specific criteria defined in the strategy parameters,</span>
<span class="sd">        including checks for volatility, liquidity, active status, base close price, and future returns.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary where keys are instrument names, and values are booleans indicating eligibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eligibility_criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;eligibility_criteria&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
            <span class="n">eligible</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Volatility check (last 5 days)</span>
            <span class="n">volatility_threshold</span> <span class="o">=</span> <span class="n">eligibility_criteria</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volatility_threshold&quot;</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">)</span>
            <span class="n">volatility_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;Volatility&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">volatility_eligible</span> <span class="o">=</span> <span class="n">volatility_mean</span> <span class="o">&gt;</span> <span class="n">volatility_threshold</span>

            <span class="c1"># Liquidity check</span>
            <span class="n">liquidity_threshold</span> <span class="o">=</span> <span class="n">eligibility_criteria</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;liquidity_threshold&quot;</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="n">liquidity_eligible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;Liquidity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">liquidity_threshold</span>

            <span class="c1"># Additional checks</span>
            <span class="n">active_eligible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;Active&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>
            <span class="n">positive_close_eligible</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>

            <span class="n">max_return_threshold</span> <span class="o">=</span> <span class="mf">0.20</span>
            <span class="n">last_return_eligible</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;Returns&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_return_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>

            <span class="c1"># Combine all eligibility checks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">][</span><span class="s1">&#39;Eligible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">volatility_eligible</span>
                <span class="o">&amp;</span> <span class="n">liquidity_eligible</span>
                <span class="o">&amp;</span> <span class="n">active_eligible</span>
                <span class="o">&amp;</span> <span class="n">positive_close_eligible</span>
                <span class="o">&amp;</span> <span class="n">last_return_eligible</span>
            <span class="p">)</span>
</code></pre></div>
<p>In advanced scenarios, we may expand or shrink the investible universe based on additional specific criteria / filters. These can encompass financial metrics such as P/E ratios and dividend yields or market behaviors like volatility and trading volume, or sector-specific data. By applying such filters, we can focus on assets that align with our specific investment criteria or risk profiles, effectively tailoring our approach to our strategy and risk tolerance. For instance, some use Lo's Variance Ratio to detect market patterns, adjusting their strategies to exploit trends or guard against reversals. This dynamic adjustment helps optimize returns and manage risks. </p>
<p>Currently, this feature is not implemented. However, we do have a market regime identification system in place that adjusts daily transactions. This adjustment is made using a benchmark with a straightforward yet effective approach. Refer to the following configuration:</p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;market_regime_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;indicators&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;moving_average_slope&quot;</span><span class="p">,</span> <span class="s2">&quot;breadth_thrust&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;moving_average_slope&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                            <span class="s2">&quot;breadth_thrust&quot;</span><span class="p">:</span> <span class="mf">0.5</span>
        <span class="p">},</span>
</code></pre></div>
<p>and function in code:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_market_regime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocess the market regime based on the historical market data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preprocessing market regime.&quot;</span><span class="p">)</span>

        <span class="n">benchmark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;benchmark&#39;</span><span class="p">]</span>
        <span class="n">market_regime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager</span><span class="o">.</span><span class="n">get_market_data</span><span class="p">([</span><span class="n">benchmark</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">trading_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">market_regime_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error fetching benchmark data.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error fetching benchmark data.&quot;</span><span class="p">)</span>

        <span class="c1"># Passing config to market regime class</span>
        <span class="n">market_regime_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;market_regime_params&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Passing config to market regime class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_regime</span> <span class="o">=</span> <span class="n">MarketRegime</span><span class="o">.</span><span class="n">create_with_data</span><span class="p">(</span><span class="n">market_regime_config</span><span class="p">,</span> <span class="n">market_regime_data</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">)</span>

        <span class="c1"># Calculate the market regime for each date in the trading range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_regime</span><span class="o">.</span><span class="n">identify_regime</span><span class="p">()</span>

        <span class="c1"># Convert the market regime data to the desired index labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;sideways&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;bull&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;bear&#39;</span><span class="p">})</span>

        <span class="c1"># # Get the trading dates as a timezone-aware DatetimeIndex and convert to UTC</span>
        <span class="n">trading_dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_manager</span><span class="o">.</span><span class="n">get_trading_dates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trading_range</span><span class="p">))</span>
        <span class="n">trading_dates_utc</span> <span class="o">=</span> <span class="n">trading_dates</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>

        <span class="c1"># Localize the market regime data to the &#39;UTC&#39; timezone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>

        <span class="c1"># Resample market_regime_data to match the frequency of trading dates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">trading_dates_utc</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfill&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Market regime preprocessing completed.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>and use in the loop:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get the market regime for the current date from the market_regime_series</span>
<span class="n">current_market_regime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_regime_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">current_date</span><span class="p">]</span>

<span class="c1"># Generate daily transactions for the current trading day based on the generated signals and current market regime</span>
<span class="n">daily_transactions_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_daily_transactions</span><span class="p">(</span><span class="n">current_date</span><span class="p">,</span> <span class="n">current_market_regime</span><span class="p">)</span>

<span class="c1"># Adjust daily transactions based on the risk profiles</span>
<span class="n">daily_transactions_adjusted_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">risk_management</span><span class="o">.</span><span class="n">adjust_transactions_with_risk_profiles</span><span class="p">(</span><span class="n">daily_transactions_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">,</span> <span class="n">current_market_regime</span><span class="p">)</span>
</code></pre></div>
<h3 id="indicators">Indicators<a class="headerlink" href="#indicators" title="Permanent link">&para;</a></h3>
<p>Indicators are quantitative values derived from market data. Examples of indicators include moving averages, RSI, MACD, volatility bands, channels, factor models, and theoretical pricing models. They <strong><em>are calculated in advance on market data</em></strong> (or on other indicators). Indicators have no knowledge of current positions or trades.</p>
<p>A common risk when defining your indicators is confusing the indicator with the strategy. The indicator is a model that describes some aspect of the market or a theoretical price. It is not a strategy on its own. A strategy requires interactions with its other components to be fully specified.</p>
<p>In the backtesting framework, you can use indicators from fundamental analysis - calculated as key ratios based on companies' financial statements (income statement, balance sheet, and profit and loss) - as well as technical indicators.  Just to name few:</p>
<div class="highlight"><pre><span></span><code><span class="n">Functions</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">RSI</span>
        <span class="o">-</span> <span class="n">SMA</span>
        <span class="o">-</span> <span class="n">EMA</span>
        <span class="o">-</span> <span class="n">BB</span>
        <span class="o">-</span> <span class="n">ATR</span>
        <span class="o">-</span> <span class="n">SAR</span>
        <span class="o">-</span> <span class="n">MACD</span>
        <span class="o">-</span> <span class="n">STOCH</span>
        <span class="o">-</span> <span class="n">ADX</span>
        <span class="o">-</span> <span class="n">CCI</span>
        <span class="o">-</span> <span class="n">WILLR</span>
        <span class="o">-</span> <span class="n">OBV</span>
        <span class="o">-</span> <span class="n">ROC</span>
        <span class="o">-</span> <span class="n">TRIX</span>
        <span class="o">-</span> <span class="n">KELTNER_CHANNELS</span>
        <span class="o">-</span> <span class="n">DONCHIAN_CHANNELS</span>
        <span class="o">-</span> <span class="n">AROON</span>
        <span class="o">-</span> <span class="n">STDEV</span>
        <span class="o">-</span> <span class="n">ULTIMATE_OSCILLATOR</span>
        <span class="o">-</span> <span class="n">ADXR</span>
        <span class="o">-</span> <span class="n">CMO</span>
        <span class="o">-</span> <span class="n">MFI</span>
        <span class="o">-</span> <span class="n">PRICE_ROC</span>
</code></pre></div>
<p>and for fundamental ones:</p>
<div class="highlight"><pre><span></span><code><span class="n">gross_profit_margin</span>
<span class="n">operating_profit_margin</span>
<span class="n">net_profit_margin</span>
<span class="n">return_on_assets</span>
<span class="n">return_on_equity</span>
<span class="n">debt_to_equity</span>
<span class="n">current_ratio</span>
<span class="n">quick_ratio</span>
<span class="n">cash_flow_to_debt</span>
<span class="n">price_to_earnings</span>
<span class="n">price_to_book</span>
<span class="n">price_to_sales</span>
<span class="n">enterprise_value</span>
<span class="n">ev_to_ebitda</span>
<span class="n">ev_to_sales</span>
<span class="n">peg_ratio</span>
<span class="n">dividend_yield</span>
<span class="n">dividend_payout_ratio</span>
<span class="n">asset_turnover_ratio</span>
<span class="n">inventory_turnover_ratio</span>
<span class="n">days_sales_outstanding</span>
<span class="n">days_inventory_outstanding</span>
<span class="n">days_payables_outstanding</span>
<span class="n">cash_conversion_cycle</span>
<span class="n">earnings_per_share</span>
<span class="n">book_value_per_share</span>
<span class="n">free_cash_flow_per_share</span>
<span class="n">cash_flow_per_share</span>
<span class="n">operating_cash_flow_ratio</span>
<span class="n">free_cash_flow_to_equity</span>
<span class="n">cash_flow_to_debt_ratio</span>
<span class="n">price_to_cash_flow_ratio</span>
</code></pre></div>
<h3 id="signals">Signals<a class="headerlink" href="#signals" title="Permanent link">&para;</a></h3>
<p>In our backtesting framework we calculate indicators in SignalGeneration class (and functions as preprocess_signals) - that’s because we use only those indicators, which are used for our strategy defined in the config file with signals.</p>
<p>Signals describe the interaction between filters, market data, and indicators. Signal processes describe the desire for an action, but the strategy may choose not to act or may not be actionable at the time. They include ‘classic’ things like crossovers and thresholds, as well as more complicated interactions between pricing models, other indicators, and other signal processes. It is our experience that signals may often interact with other signals. The final signal is a composite of multiple things. The combination of intermediate signals will increase the likelihood of actually placing or modifying orders based on the final signal.</p>
<p>First see the our config for signals:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;signal_generator_params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;buy_signals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                    </span><span class="nt">&quot;SMA_10_50_crossover&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SMA(10) &gt; SMA(50)&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="nt">&quot;RSI_oversold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSI(14) &lt; 30&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="nt">&quot;MACD_signal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MACD(12, 26, 9) &gt; 0&quot;</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="nt">&quot;sell_signals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                    </span><span class="nt">&quot;SMA_10_50_reverse_crossover&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SMA(10) &lt; SMA(50)&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="nt">&quot;RSI_overbought&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSI(14) &gt; 70&quot;</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
</code></pre></div>
<p>Please note that like indicators, all the signals in our backtesting framework are calculated in advance on the market data:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocess the technical indicators for each instrument based on the historical market data and the configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            instruments (list): A list of instruments to preprocess signals for.</span>
<span class="sd">            market_data (dict): A dictionary containing historical market data per instrument.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preprocessing signals.&quot;</span><span class="p">)</span>

        <span class="n">signals_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;signal_generator_params&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">buy_signals</span> <span class="o">=</span> <span class="n">signals_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;buy_signals&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">sell_signals</span> <span class="o">=</span> <span class="n">signals_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sell_signals&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">all_signals</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">buy_signals</span><span class="p">,</span> <span class="o">**</span><span class="n">sell_signals</span><span class="p">}</span>

        <span class="c1"># List of indicators to compute</span>
        <span class="n">unique_signals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> 

        <span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">all_signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>  <span class="c1"># Replace avoids splitting function parameters    </span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">part</span> <span class="ow">and</span> <span class="s1">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
                    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
                    <span class="n">end_idx</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

                    <span class="n">indicator_name</span> <span class="o">=</span> <span class="n">part</span><span class="p">[:</span><span class="n">start_idx</span><span class="p">]</span>
                    <span class="n">params_str</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="n">start_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># Handle the case where conversion fails, indicating non-integer parameters</span>
                        <span class="c1"># This block can be adjusted based on the specific needs or expected parameter types</span>
                        <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>

                    <span class="n">unique_signals</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">indicator_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">params</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">indicator_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Removing any non-alphanumeric characters</span>
                    <span class="k">if</span> <span class="n">indicator_name</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>  <span class="c1"># Check if the part is purely alphabetic</span>
                        <span class="n">unique_signals</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">indicator_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()))</span>

        <span class="c1"># Convert set of unique indicators back to a list of lists for the output</span>
        <span class="n">unique_signals_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">unique_signals</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
            <span class="n">market_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_data</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>
            <span class="n">not_recognized_or_error_indicators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal_generator</span><span class="o">.</span><span class="n">process_technical_indicators</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="n">market_data</span><span class="p">,</span> <span class="n">unique_signals_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">not_recognized_or_error_indicators</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error computing indicators: </span><span class="si">{</span><span class="n">not_recognized_or_error_indicators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error computing indicators: </span><span class="si">{</span><span class="n">not_recognized_or_error_indicators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Signal preprocessing completed.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>What you can see, they are calculated prior simulation in a special class called SignalGenerator (additional module) with functions to evaluate signal per data, e.g. SMA(20), SMA(50) to calculate simple moving average over 20 and 50 days, and also give True/False if we asking ‘SMA(20) &gt; SMA(50)’.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market_data</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate a signal condition by replacing function calls with their computed values.</span>

<span class="sd">        Args:</span>
<span class="sd">            market_data (pd.DataFrame): A DataFrame containing historical market data.</span>
<span class="sd">            condition (str): The signal condition to evaluate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Series: A Series containing the evaluated signal values:</span>
<span class="sd">                1 for True (buy/sell signal), 0 for False (no signal).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Split the condition into parts</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c1"># Replace function calls with their computed values</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">part</span> <span class="ow">and</span> <span class="s1">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
                <span class="n">start_idx</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
                <span class="n">end_idx</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

                <span class="n">indicator_name</span> <span class="o">=</span> <span class="n">part</span><span class="p">[:</span><span class="n">start_idx</span><span class="p">]</span>
                <span class="n">params_str</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="n">start_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>

                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>

                <span class="c1"># Format parameters correctly for single-parameter scenarios without trailing commas</span>
                <span class="n">params_formatted</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
                <span class="c1">#params_formatted = &#39;,&#39;.join(map(str, params)).rstrip(&#39;,&#39;)</span>

                <span class="c1"># If there are parameters, join them with an underscore; otherwise, just use the indicator name</span>
                <span class="n">column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indicator_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_formatted</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">params_formatted</span> <span class="k">else</span> <span class="n">indicator_name</span>

                <span class="c1"># Check and replace in your condition</span>
                <span class="k">if</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">market_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;market_data[&#39;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&#39;]&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">market_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&#39; not found in market_data.&quot;</span><span class="p">)</span>

        <span class="c1"># Join the modified parts back into the condition string</span>
        <span class="n">modified_condition</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Evaluate the modified condition</span>
            <span class="n">signal_values</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">modified_condition</span><span class="p">)</span>

            <span class="c1"># Convert the boolean signal values to integers (1 for True, 0 for False)</span>
            <span class="n">signal_values</span> <span class="o">=</span> <span class="n">signal_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Handle errors related to missing or invalid data</span>
            <span class="n">signal_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">market_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">signal_values</span>
</code></pre></div>
<h3 id="rules">Rules<a class="headerlink" href="#rules" title="Permanent link">&para;</a></h3>
<p>Finally the rules.The two minimum requirements for a trading strategy are a rule to enter the market and a rule to exit the market. Typically, a strategy consists of buy and sell conditions that "mirror" each other. </p>
<p>In the default configuration file, I've defined four strategies to run in parallel. The goal is to establish rules, which serve as basic guidelines for entering and exiting the market:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;rules_params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">&quot;simple_crossover&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A simple crossover&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="nt">&quot;buy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SMA_10_50_crossover&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="nt">&quot;sell&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SMA_10_50_reverse_crossover&quot;</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="nt">&quot;trend_following&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A trend-following rule&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="nt">&quot;buy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SMA_10_50_crossover AND RSI_oversold&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="nt">&quot;sell&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SMA_10_50_reverse_crossover OR RSI_overbought&quot;</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="nt">&quot;momentum&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A momentum-based rule&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="nt">&quot;buy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MACD_signal&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="nt">&quot;sell&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSI_overbought&quot;</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="nt">&quot;mean_reversion&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A mean-reversion rule&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="nt">&quot;buy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSI_oversold&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="nt">&quot;sell&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSI_overbought&quot;</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
</code></pre></div>
<p>As we see, the rules, in both research/backtesting and in production, are what take input from market data, indicators, and signals, and actually take action. Entry, Exits, Risk, Profit Taking, and Portfolio Rebalancing are all rule processes. Rules are path dependent, meaning that they are aware of the current market state, the current portfolio, all working orders, and any other data available at the time the rule is being evaluated. No action is instantaneous, so rules also have a cost in time.</p>
<p><strong><em>Hypothesis Driven Development</em></strong></p>
<p>Creating a strategy is costly in terms of time, which is needed for research, and money for implementation into a live trading environment. To maximize return on this investment, we adopt a hypothesis-driven approach. This enables us to quickly confirm ideas, reject failures with minimal cost, and avoid many overfitting risks.</p>
<p>Each component of the strategy, including filters, indicators, signals, and various types of rules, represents different parts of the strategy's hypothesis and business objectives. Our goal at every stage should be to ensure that every component of the strategy is effective: adding value, improving predictions, validating the hypothesis, etc., before proceeding to the next component.</p>
<p>To understand the results of a trading model and hypothesis I like to follow the even steps model:</p>
<hr />
<ol>
<li>Formulate the trading strategy.</li>
<li>Write the rules in a definitive form.</li>
<li>Test the trading strategy.</li>
<li>Optimize the trading strategy.</li>
<li>Trade the strategy.</li>
<li>Monitor trading performance and compare it to test performance.</li>
<li>Improve and refine the trading strategy.</li>
</ol>
<p>Each of these steps depends on the success of the preceding one. </p>
<p>To comprehend the outcomes of a trading model and hypothesis, I prefer using the seven-step model:</p>
<hr />
<ol>
<li>Formulate the trading strategy and benchmark.</li>
<li>Define the filters, signals and rules explicitly.</li>
<li>Test the trading strategy against benchmark.</li>
<li>Optimise the trading strategy.</li>
<li>Implement the strategy through trades.</li>
<li>Monitor trading performance and compare it with the test performance.</li>
<li>Enhance and refine the trading strategy.</li>
</ol>
<p>The success of each step is contingent upon the success of the previous one.</p>
<p>During the creation and testing of hypotheses, most strategy ideas are rejected. Many observations about market conditions lack the structure needed to form a testable hypothesis. Even if these ideas might be correct, they cannot be used to create a quantitative strategy with confidence unless they can be quantified into a provable or disprovable conjecture. This process protects against pursuing fundamentally questionable or erroneous ideas and is a valuable use of time. The quicker an untestable idea is dismissed for more verifiable ones, the better.</p>
<p><strong>A bit more on elements of further roadmap and studies:</strong></p>
<p>You might have noticed the section of the code that evaluates indicators. This can be quite challenging without a defined action theory as indicators represent measurable aspects of reality, such as theoretical prices, factor impacts, series turning points, or slope. A solid understanding of an indicator's properties allows us to apply a symmetric filter to historical data, like ARMA or Kalman processes. However, these are descriptive rather than predictive, as they primarily describe past behavior. We can further refine our code by comparing the indicator with the filter using methods such as kernel methods, clustering, mean squared error, or distance measures.</p>
<p>Similarly, a signal is a directional prediction for a specific point in time. The timing of this signal can vary based on the parameterisation of the indicator and/or signal functions.</p>
<p>The same principle applies to signals per regime or region. When comparing input parameter expectations, you should see clusters of similar positive and/or negative return expectations in similar or contiguous parameter combinations.</p>
<p>The signals generated by the backtests can also be empirically classified. You can measure statistics like the number of entry and exit signals, the distribution of the period between entries and exits, and the degree of overlap between entry and exit signals.</p>
<p>This task has been started in a separate class called PerformanceReporting. However, it will need a few more days to be fully completed.</p>
<p>Since every signal is a prediction, we can utilize the literature on model specification and testing of predictions when analyzing signal processes. Methods range from simple ones, such as mean squared model error or kernel distance from an ideal process, to more extensive evaluation techniques like the Akaike Information Criterion (AIC), Bayesian Information Criterion (BIC), or cross-validation.</p>
<p>Finally we have signal decay - factors with faster decay require higher turnover, while higher turnover incurs greater transaction cost, which has to be balanced with the predictive power of the models. Some signals decay so quickly that alpha opportunity disappears within hours, minutesor even seconds. For example, a simple backtesting of the one-day reversal factor (i.e., buying stocks that have fallen the most on the previous day) seems to suggest that
short-term reversal is a great strategy. The only problem is that the factor itself can only
be computed after the market closes; therefore, the earliest time we can trade on the
signal is at the next day’s open.</p>
<p>That is not yet implemented, hence offers quite interesting further development.</p>
<p>Outliers, Z-Score</p>
<p>As for my own studies, I backtesting a lot of Middle-East equities, there are a lot of outliers. And the easiest way to deal with outliers is to control them. More often than not, outliers are caused by data errors or specific events that are unlikely to be repeated in the future. There is little information on outliers and they usually cause more harm than good. We could either remove them from our sample completely or impose some restrictions by winsorization.
Unlike data truncation, winsorization replaces data greater or less than certain extreme x percentiles (often set as 5%, 1%, or 0.1%) with the xth percentile values. That’s is being implemented too.</p>
<p>We use Z-score for data normalization as well. Our preferred method for this is through a ranking transformation, wherein we rank all stocks based on their factor scores. This ranking transformation transforms any distribution into a uniform one, effectively managing outliers into a reasonable data range. In our proprietary models, we take it a step further by applying an inverse normal transformation, ensuring our factors always follow a standard normal distribution with a mean of zero and a standard deviation of one.</p>
<p>Given that there's more to cover and this post is already quite lengthy, the following topics will be discussed in more detail in the next post (likely next week):</p>
<p>Regime analysis, rebalancing and asset allocation, the empirical nature of entry/exit rules, trader statistics, and a few biases such as look-ahead bias, survivorship bias, data mining bias, and data snooping bias.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href='https://quantjourney.substack.com' target='_blank'>jpolec</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jpolec/quantjourney" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/jakubpolec/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCe87vJTlGGtVt-UwiVQhmdQ" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["codehilite", "pymdownx.superfences", "pymdownx.details", "pymdownx.emoji", "pymdownx.tasklist", "pymdownx.tilde", "pymdownx.magiclink", "pymdownx.highlight", "pymdownx.tabbed", "pymdownx.caret", "pymdownx.smartsymbols", "pymdownx.snippets", "pymdownx.inlinehilite", "navigation.tabs", "navigation.tabs.sticky", "navigation.scroll", "navigation.top", "navigation.bottom", {"navigation.expand": true}, "footer", "search", "search.suggest", "code-highlighting", "edit-on-github", "external-links", "code-tabs", "content-tabs", "content.tabs.link", "content.code.annotation", "content.code.copy", "tabbed-code-blocks"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
        <script src="https://kit.fontawesome.com/7b3f6f1b5b.js"></script>
      
    
  </body>
</html>